# Отчёт по 4 практической работе по дисциплине "Система для сбора событий и логов"
Автор: студент РТУ МИРЭА группы ББМО-01-22 Кузькин Павел Александрович
## Задание 1
Скачаем готовую виртуальную машину (ВМ) для Oracle VirtualBox по ссылке https://thunt-level1.s3.amazonaws.com/vbox-thunt-L1-202308.zip,
на которой развёрнут сервис AC-Hunter. Добавим машину и запустим её (пароль - hunting):

![img.png](img.png)

Обратимся к ВМ через веб-браузер хостовой операционной системы (ОС) Windows 11 Pro и войдём в сервис AC-Hunter (пароль - hunting2):

![img_1.png](img_1.png)
![img_2.png](img_2.png)

Перейдём в директорию для первого задания:

![img_3.png](img_3.png)

Выполним импорт с помощью rita:

![img_4.png](img_4.png)

Удостоверимся, что в списке появилось название lab1:

![img_5.png](img_5.png)

Откроем lab1:

![img_6.png](img_6.png)

Перейдём во вкладку beacons web, увидим 6 записей, которые набрали более 80 баллов:

![img_7.png](img_7.png)

Рассмотрим поподробнее эти 6 записей. 

В первой записи мы видим, что beacon score имеет самое большое значение. 
Агент пользователя - Windows 7 (довольно старая ОС). Нет указания FQDN веб-сервера. 
Кроме того, видно большое количество подключений за последние 24 часа - 3011.
Таким образом, не ясно, можно ли добавлять эту запись в безопасный лист или нет.

Проанализируем вторую запись:

![img_8.png](img_8.png)

Во второй записи указан узел оптимизации доставки Microsoft. Для исправления ошибок используется Windows.
Сертификат выглядит легитимным. Таким образом, эту запись можно добавить в безопасный список. 

Проанализируем третью запись:

![img_9.png](img_9.png)

Здесь мы видим, что указан Windows title service, так что эту запись можно занести в безопасный список.

Проанализируем четвёртую запись:

![img_10.png](img_10.png)

Здесь мы также видим исправление ошибок Windows, поэтому можно также добавить в безопасный список.

Проанализируем пятую запись (она относится к обновлениям Windows, поэтому можно занести в безопасный список):

![img_11.png](img_11.png)

Проанализируем шестую запись (она отноcится к исправлениям ошибок Windows, поэтому можно занести в безопасный список):

![img_12.png](img_12.png)

Добавим безопасные записи в соответствующий список, также включим использование подстановочных знаков
(сюда входит array503, array506, array509):

![img_14.png](img_14.png)

Далее добавим ещё две записи в безопасный список и отобразим все созданные правила:

![img_15.png](img_15.png)

Откроем вкладку Longest Connection. Увидим, что для обоих записей не опеределён FQDN (ACH хранит FQDN 24 часа, 
а здесь после 24 часов оба имени помечены, как неизвестные):

![img_13.png](img_13.png)

Проверим эти адреса с помощью VirusTotal. Увидим, что вредоносов нет:

![img_20.png](img_20.png)
![img_21.png](img_21.png)

Вернёмся к самой первой записи (beacon score имеет значение 99,70%) и проанализируем её детальнее
(возможно здесь замешана угроза С2). Видим, что не происходил запрос FQDN перед подключением:

![img_16.png](img_16.png)

Если обратиться к логам HTTP, то можно заметить, что  FQDN отсутствует (вместо него адрес).
Кроме того, в качестве агента указан Windows 7, при этом видим FQDN, которые используются при работе windows 10, а не 7:

![img_17.png](img_17.png)

Также можно заметить, что общение Windows 7 происходит только в одном случае (в других случаях используется Windows 10):

![img_18.png](img_18.png)

Далее можно заметить, что 3011 соединений имеют одну и ту же подозрительно длинную ссылку.
Поэтому скорее всего это вредоностное подключение:

![img_19.png](img_19.png)
## Задание 2
Импортируем данные для второго задания и откроем его (результатов нет, но мы видим верху запись об одной угрозе C2 через DNS):

![img_22.png](img_22.png)
![img_23.png](img_23.png)
![img_24.png](img_24.png)

Здесь мы видим слишком большое количество уникальных записей - 2074. При этом пользователи не получают доступа к ресурсам:

![img_25.png](img_25.png)

Кроме того, можно заметить, что имя хоста состоит из шестнадцетиричного кода, это очень странно, учитывая,
что мы обычно не используем такое при выдаче имени:

![img_26.png](img_26.png)

Таким образом, можно с уверенностью сказать, что это C2 через DNS.
## Задание 3
Импортируем данные для третьего задания и откроем его:

![img_27.png](img_27.png)
![img_28.png](img_28.png)
![img_29.png](img_29.png)

Зайдём в раздел beacons web. Рассмотрим пару записей из этого раздела.

Отобразим информацию по первой записи:

![img_30.png](img_30.png)

Заметим, что в данной записи используется домен Skype, но нельзя сказать, что он настоящий.
Также здесь указан internet explorer в качестве агента. Время ожидания соединения колеблется. 
Проверка на VirusTotal показывает, что здесь имеется вредонос:

![img_31.png](img_31.png)

Таким образом, необходимо принять меры для устранения данного инцидента.

Отобразим информацию по второй записи. Здесь мы видим доменное имя, которое используется при работе
с Microsoft Office, поэтому, если в системе используется Microsoft Office, то все нормально
(можно добавить это событие в безопасный список):

![img_32.png](img_32.png)

Теперь зайдём в раздел beacons, увидим два DNS-запроса к OpenDNS.
Если обращение к OpenDNS было запланировано, то бояться нечего, иначе нужно проверить конечные точки:

![img_33.png](img_33.png)
![img_34.png](img_34.png)